<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taller Azteca - Repuestos, Turnos y Pago</title>
  <style>
    :root{
      --bg-900:#0b0c0d;
      --panel:#0f1112;
      --card:#121314;
      --muted:#bfc5c4;
      --accent:#c45a2f; /* terracotta accent for small highlights */
      --btn-bg:#e9ecef; /* lighter buttons */
      --btn-text:#0b0c0d;
      --glass:rgba(255,255,255,0.03);
      --shadow:0 12px 30px rgba(2,6,10,0.6);
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-900),#071011);color:var(--muted);-webkit-font-smoothing:antialiased}

    /* Header */
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));backdrop-filter:blur(4px);position:sticky;top:0;z-index:50}
    .left{display:flex;align-items:center;gap:12px}
    .logo{width:60px;height:60px;border-radius:10px;background:linear-gradient(180deg,#141617,#0f1112);display:grid;place-items:center;border:1px solid rgba(255,255,255,0.03)}
    .logo img{width:48px;height:48px;border-radius:8px;object-fit:cover}
    .center{flex:1;text-align:center}
    .center h1{margin:0;font-size:18px;letter-spacing:1px;color:var(--muted)}
    nav{display:flex;gap:8px;align-items:center}
    .nav-btn{background:var(--btn-bg);color:var(--btn-text);border-radius:10px;padding:8px 10px;border:1px solid rgba(0,0,0,0.05);cursor:pointer;font-weight:600}

    /* cart badge */
    .cart-btn{position:relative}
    .cart-count{position:absolute;top:-6px;right:-8px;background:var(--accent);color:#071011;font-weight:700;padding:3px 6px;border-radius:999px;font-size:12px}

    main{max-width:1120px;margin:16px auto;padding:0 12px}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:980px){.layout{grid-template-columns:1fr;padding:0 10px}}

    .controls{display:flex;gap:10px;margin:12px 0;align-items:center}
    .search{flex:1}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--card);color:var(--muted)}
    .select{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--panel);color:var(--muted)}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border-radius:12px;padding:10px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;transition:transform .22s ease,box-shadow .22s ease}
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.55)}
    .card img{width:100%;height:150px;object-fit:cover;border-radius:8px}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .pill{background:var(--glass);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}

    .actions{display:flex;gap:8px;justify-content:flex-end}
    .btn-light{background:var(--btn-bg);color:var(--btn-text);padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.05);cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#071011;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:700}

    aside{background:linear-gradient(180deg,#0d0f10,#0b0c0d);border-radius:12px;padding:12px;min-height:240px}

    label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#0a0b0c;color:var(--muted)}
    textarea{resize:vertical}

    /* cart modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,10,0.65);z-index:200}
    .modal.open{display:flex}
    .modal .box{background:linear-gradient(180deg,#0a0b0c,#0f1112);color:var(--muted);padding:18px;border-radius:12px;max-width:720px;width:94%;box-shadow:var(--shadow);position:relative}
    .close-x{position:absolute;right:12px;top:10px;font-size:20px;cursor:pointer}
    .cart-list{max-height:320px;overflow:auto;margin-top:10px}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
    .quantity{display:flex;gap:6px;align-items:center}

    .animate-fade{animation:fadeIn .26s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

    footer{margin-top:22px;text-align:center;color:rgba(255,255,255,0.18);font-size:13px}

    @media(max-width:600px){
      header{padding:10px}
      .center h1{font-size:16px}
      .layout{grid-template-columns:1fr}
      aside{order:2}
    }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <div class="logo"><img src="https://source.unsplash.com/200x200/?aztec,pattern" alt="logo"/></div>
      <div style="display:flex;flex-direction:column">
        <div style="font-size:12px;color:var(--muted)">Repuestos y servicio</div>
        <div style="font-weight:700;color:var(--muted)">Taller Azteca</div>
      </div>
    </div>

    <div class="center"><h1>Taller Azteca</h1></div>

    <nav>
      <button class="nav-btn" onclick="scrollToCatalog()">Cat√°logo</button>
      <button class="nav-btn" onclick="openAdmin()">Propietario</button>
      <button class="nav-btn cart-btn" id="openCartBtn" onclick="openCart()">Carrito üõí<span id="cartCount" class="cart-count">0</span></button>
    </nav>
  </header>

  <main>
    <div class="layout">
      <section>
        <div class="controls">
          <div class="search"><input id="search" placeholder="Buscar repuestos, marca o modelo" /></div>
          <select id="filterCategory" class="select">
            <option value="">Todas las categor√≠as</option>
            <option value="motor">Motor</option>
            <option value="frenos">Frenos</option>
            <option value="suspension">Suspensi√≥n</option>
            <option value="electrico">El√©ctrico</option>
          </select>
          <select id="sortPrice" class="select">
            <option value="">Ordenar</option>
            <option value="asc">Precio: menor ‚Üí mayor</option>
            <option value="desc">Precio: mayor ‚Üí menor</option>
          </select>
        </div>

        <div id="catalog" class="grid"></div>

        <footer>¬© Taller Azteca</footer>
      </section>

      <aside>
        <h3 style="margin:0;color:var(--muted)">Agendar turno</h3>
        <div style="height:8px"></div>
        <label for="apptName">Nombre completo</label>
        <input id="apptName" placeholder="Ej: Juan P√©rez" />
        <label for="apptPhone">Tel√©fono</label>
        <input id="apptPhone" placeholder="Ej: 11 1234 5678" />
        <div style="display:flex;gap:8px">
          <div style="flex:1">
            <label>Marca</label>
            <input id="apptBrand" placeholder="Ej: Ford" />
          </div>
          <div style="width:110px">
            <label>A√±o</label>
            <input id="apptYear" type="number" placeholder="2016" />
          </div>
        </div>
        <label>Fecha y hora</label>
        <input id="apptDatetime" type="datetime-local" />
        <label>Problema (breve)</label>
        <input id="apptProblemShort" placeholder="Ej: ruido al frenar" />
        <div style="height:10px"></div>
        <button class="btn-primary" id="submitAppt">Agendar turno</button>

        <div id="apptListContainer" style="margin-top:18px">
          <h4 style="margin:0 0 8px 0;color:var(--muted)">Turnos pr√≥ximos</h4>
          <div id="apptList" style="max-height:260px;overflow:auto"></div>
        </div>
      </aside>
    </div>
  </main>

  <!-- ADMIN modal -->
  <div id="adminModal" class="modal">
    <div class="box animate-fade">
      <div class="close-x" onclick="closeAdmin()">‚úñ</div>
      <h3 style="margin-top:0">Panel Propietario</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="p_name" placeholder="Nombre (ej: Filtro aire)" style="flex:1" />
        <input id="p_price" placeholder="Precio" style="width:110px" />
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="p_brand" placeholder="Marca" style="flex:1" />
        <input id="p_stock" placeholder="Stock" style="width:110px" />
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <select id="p_cat" style="flex:1">
          <option value="motor">Motor</option>
          <option value="frenos">Frenos</option>
          <option value="suspension">Suspensi√≥n</option>
          <option value="electrico">El√©ctrico</option>
        </select>
        <input id="p_img" placeholder="Imagen URL (opcional)" />
      </div>
      <textarea id="p_desc" rows="3" style="margin-top:8px" placeholder="Descripci√≥n opcional"></textarea>

      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="btn-light" id="cancelEditBtn" onclick="cancelEdit()">Cancelar</button>
        <button class="btn-light" id="deletePart" style="background:#2b2b2b;color:#fff;" onclick="deleteEditing()">Eliminar</button>
        <button class="btn-primary" id="savePart">Guardar</button>
      </div>

      <h4 style="color:var(--muted);margin-top:14px">Turnos</h4>
      <div id="adminAppts" style="max-height:180px;overflow:auto;margin-top:8px"></div>
    </div>
  </div>

  <!-- CART modal -->
  <div id="cartModal" class="modal">
    <div class="box animate-fade">
      <div class="close-x" onclick="closeCart()">‚úñ</div>
      <h3 style="margin-top:0">Tu carrito</h3>
      <div id="cartList" class="cart-list"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-weight:800">
        <div>Total</div>
        <div id="cartTotal">$0</div>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn-light" onclick="closeCart()">Seguir comprando</button>
        <button class="btn-primary" onclick="openCheckout()">Pagar</button>
      </div>
    </div>
  </div>

  <!-- CHECKOUT modal (mock Cuenta DNI) -->
  <div id="checkoutModal" class="modal">
    <div class="box animate-fade">
      <div class="close-x" onclick="closeCheckout()">‚úñ</div>
      <h3 style="margin-top:0">Pago ‚Äî Cuenta DNI</h3>
      <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6f/Cuenta_DNI_logo.png" alt="Cuenta DNI" style="width:84px;height:44px;object-fit:contain;background:#fff;padding:6px;border-radius:8px" onerror="this.style.display='none'" />
        <div style="color:var(--muted)">Paga con Cuenta DNI ingresando tu DNI. Esto es una simulaci√≥n; para pagos reales se requiere integraci√≥n bancaria y backend seguro.</div>
      </div>

      <label style="margin-top:12px">DNI del pagador</label>
      <input id="dniPay" placeholder="Ej: 20123456" />
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn-light" onclick="closeCheckout()">Volver</button>
        <button class="btn-primary" onclick="confirmPayment()">Pagar ahora</button>
      </div>
    </div>
  </div>

  <!-- CONFIRM modal -->
  <div id="confirmModal" class="modal">
    <div class="box animate-fade">
      <div class="close-x" onclick="closeConfirm()">‚úñ</div>
      <div id="confirmContent" style="text-align:center;padding:10px;color:var(--muted)"></div>
      <div style="text-align:center;margin-top:12px"><button class="btn-primary" onclick="closeConfirm()">Cerrar</button></div>
    </div>
  </div>

  <script>
    // -- Storage keys
    const LS_PARTS='ta_parts_prod_v2';
    const LS_APPTS='ta_appts_prod_v2';
    const LS_CART='ta_cart_v1';
    const LS_PW='ta_owner_pw_prod_v1';
    if(!localStorage.getItem(LS_PW)) localStorage.setItem(LS_PW,'taller123');

    function uid(){return Math.random().toString(36).slice(2,9)}

    function seed(){
      if(!localStorage.getItem(LS_PARTS)){
        const sample=[
          {id:uid(),name:'Filtro de aire',brand:'Bosch',model:'AF-100',year:2018,price:5800,stock:5,img:'',desc:'Filtro de alto rendimiento.',cat:'motor'},
          {id:uid(),name:'Disco de freno',brand:'Ferodo',model:'FD-200',year:2016,price:9200,stock:8,img:'',desc:'Disco ventilado.',cat:'frenos'},
          {id:uid(),name:'Amortiguador',brand:'Monroe',model:'A-500',year:2015,price:12000,stock:3,img:'',desc:'Amortiguador delantero.',cat:'suspension'}
        ];
        localStorage.setItem(LS_PARTS,JSON.stringify(sample));
      }
      if(!localStorage.getItem(LS_APPTS)) localStorage.setItem(LS_APPTS,JSON.stringify([]));
      if(!localStorage.getItem(LS_CART)) localStorage.setItem(LS_CART,JSON.stringify([]));
    }
    seed();

    function getParts(){return JSON.parse(localStorage.getItem(LS_PARTS)||'[]')}
    function saveParts(a){localStorage.setItem(LS_PARTS,JSON.stringify(a))}
    function getAppts(){return JSON.parse(localStorage.getItem(LS_APPTS)||'[]')}
    function saveAppts(a){localStorage.setItem(LS_APPTS,JSON.stringify(a))}
    function getCart(){return JSON.parse(localStorage.getItem(LS_CART)||'[]')}
    function saveCart(a){localStorage.setItem(LS_CART,JSON.stringify(a));updateCartCount();}

    function getStockImage(query){const q=encodeURIComponent((query||'auto').split(' ').slice(0,6).join(' '));return `https://source.unsplash.com/800x600/?${q},car,auto`}

    // Catalog rendering with add-to-cart
    function renderCatalog(){
      const q=document.getElementById('search').value.toLowerCase();
      const cat=document.getElementById('filterCategory').value;
      const sort=document.getElementById('sortPrice').value;
      let parts=getParts();
      if(cat) parts=parts.filter(p=>p.cat===cat);
      if(q) parts=parts.filter(p=>[p.name,p.brand,p.model,p.desc,(p.year||'')].join(' ').toLowerCase().includes(q));
      if(sort==='asc') parts.sort((a,b)=>a.price-b.price);
      if(sort==='desc') parts.sort((a,b)=>b.price-a.price);
      const el=document.getElementById('catalog');
      if(parts.length===0){el.innerHTML='<div style="padding:18px;background:var(--card);border-radius:10px;color:var(--muted)">No se encontraron repuestos</div>';return}
      el.innerHTML=parts.map(p=>{
        const img = p.img && p.img.trim()? p.img : getStockImage(p.name+' '+(p.brand||''));
        return `
          <div class="card">
            <img src="${img}" alt="${escapeHtml(p.name)}" onerror="this.onerror=null;this.src='${getStockImage('car parts')}'" />
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">${escapeHtml(p.name)}</div>
              <div class="pill">${p.cat}</div>
            </div>
            <div style="color:var(--muted);font-size:13px">${escapeHtml(p.brand)} ‚Ä¢ ${escapeHtml(p.model||'')} ‚Ä¢ ${p.year||''}</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div style="font-weight:800;color:var(--accent-2 || '#00b39b')">$${Number(p.price).toLocaleString('es-AR')}</div>
              <div style="display:flex;gap:8px">
                <button class="btn-light" onclick="showDetails('${p.id}')">Detalles</button>
                <button class="btn-primary" onclick="addToCart('${p.id}')">Agregar</button>
              </div>
            </div>
          </div>
        `
      }).join('')
    }

    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c])}

    // DETAILS -> detail modal uses confirmModal
    function showDetails(id){const p=getParts().find(x=>x.id===id);if(!p) return;const modal=document.getElementById('confirmModal');document.getElementById('confirmContent').innerHTML = `
        <h3 style="margin-top:0">${escapeHtml(p.name)}</h3>
        <img src="${p.img && p.img.trim()?p.img:getStockImage(p.name)}" style="width:100%;height:200px;object-fit:cover;border-radius:8px" onerror="this.onerror=null;this.src='${getStockImage('car parts')}'" />
        <p style="color:var(--muted)">${escapeHtml(p.brand)} ‚Ä¢ ${escapeHtml(p.model||'')} ‚Ä¢ ${p.year||''}</p>
        <p>${escapeHtml(p.desc||'Sin descripci√≥n')}</p>
        <div style="font-weight:800;color:var(--accent);margin-top:8px">$${Number(p.price).toLocaleString('es-AR')}</div>
        <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
          <button class="btn-light" onclick="document.getElementById('confirmModal').classList.remove('open')">Cerrar</button>
          <button class="btn-primary" onclick="addToCart('${p.id}');document.getElementById('confirmModal').classList.remove('open')">Agregar al carrito</button>
        </div>
      `;modal.classList.add('open')}
    function closeConfirm(){document.getElementById('confirmModal').classList.remove('open')}

    // CART logic
    function getCart(){return JSON.parse(localStorage.getItem(LS_CART)||'[]')}
    function saveCart(cart){localStorage.setItem(LS_CART,JSON.stringify(cart));renderCart();updateCartCount();}

    function addToCart(id){
      const parts=getParts();const p=parts.find(x=>x.id===id);if(!p) return alert('No encontrado');
      const cart=getCart();const existing=cart.find(i=>i.id===id);
      if(existing){existing.qty+=1} else {cart.push({id:p.id,name:p.name,price:p.price,qty:1,img:p.img||''})}
      saveCart(cart);
      // small confirmation toast (modal)
      showTempConfirm('Agregado al carrito', `${p.name} fue a√±adido al carrito.`);
    }

    function renderCart(){
      const cart=getCart();const el=document.getElementById('cartList');
      if(!el) return; if(cart.length===0){el.innerHTML='<div style="color:var(--muted)">El carrito est√° vac√≠o</div>';document.getElementById('cartTotal').textContent='$0';updateCartCount();return}
      el.innerHTML=cart.map(item=>`<div class="cart-item"><img src="${item.img||getStockImage(item.name)}" style="width:64px;height:48px;object-fit:cover;border-radius:6px" onerror="this.onerror=null;this.src='${getStockImage('car parts')}'" /><div style="flex:1"><div style="font-weight:700">${escapeHtml(item.name)}</div><div style="color:var(--muted);font-size:13px">$${Number(item.price).toLocaleString('es-AR')}</div></div><div class="quantity"><button class="btn-light" onclick="changeQty('${item.id}',-1)">-</button><div style="min-width:28px;text-align:center">${item.qty}</div><button class="btn-light" onclick="changeQty('${item.id}',1)">+</button></div><div style="width:80px;text-align:right;font-weight:800">$${(item.price*item.qty).toLocaleString('es-AR')}</div><div style="width:38px;text-align:right"><button class="btn-light" onclick="removeCartItem('${item.id}')">‚úñ</button></div></div>`).join('');
      const total=cart.reduce((s,i)=>s+i.price*i.qty,0);document.getElementById('cartTotal').textContent=`$${Number(total).toLocaleString('es-AR')}`;updateCartCount();
    }

    function updateCartCount(){const cart=getCart();document.getElementById('cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0)}
    function changeQty(id,delta){const cart=getCart();const it=cart.find(i=>i.id===id);if(!it) return;it.qty+=delta;if(it.qty<=0){const idx=cart.findIndex(i=>i.id===id);cart.splice(idx,1)}saveCart(cart)}
    function removeCartItem(id){let cart=getCart();cart=cart.filter(i=>i.id!==id);saveCart(cart)}

    function openCart(){document.getElementById('cartModal').classList.add('open');renderCart()}
    function closeCart(){document.getElementById('cartModal').classList.remove('open')}

    // CHECKOUT (mock Cuenta DNI)
    function openCheckout(){const cart=getCart();if(cart.length===0){alert('El carrito est√° vac√≠o');return}document.getElementById('checkoutModal').classList.add('open')}
    function closeCheckout(){document.getElementById('checkoutModal').classList.remove('open')}
    function confirmPayment(){const dni=document.getElementById('dniPay').value.trim();if(!dni) return alert('Ingrese DNI');
      // Mock payment processing
      setTimeout(()=>{
        // create order record (simple)
        const order={id:uid(),dni,cart:getCart(),total:getCart().reduce((s,i)=>s+i.price*i.qty,0),created:new Date().toISOString()};
        const orders = JSON.parse(localStorage.getItem('ta_orders_v1')||'[]');orders.unshift(order);localStorage.setItem('ta_orders_v1',JSON.stringify(orders));
        // clear cart
        saveCart([]);
        closeCheckout();
        document.getElementById('confirmContent').innerHTML=`<div style="font-weight:800;color:#fff;font-size:18px">Pago exitoso</div><div style="margin-top:8px;color:var(--muted)">Gracias por su compra. Operaci√≥n con Cuenta DNI simulada. Order ID: <strong>${order.id}</strong></div>`;
        document.getElementById('confirmModal').classList.add('open');
      },900);
    }

    function closeConfirm(){document.getElementById('confirmModal').classList.remove('open')}

    // ADMIN functions (short form and functional buttons)
    let editing=null;
    function openAdmin(){const pw=prompt('Contrase√±a propietario:');if(!pw) return; if(pw!==localStorage.getItem(LS_PW)){alert('Contrase√±a incorrecta');return}document.getElementById('adminModal').classList.add('open');fillAdminAppts();}
    function closeAdmin(){document.getElementById('adminModal').classList.remove('open');clearPartForm();editing=null}

    function openEdit(id){const p=getParts().find(x=>x.id===id);if(!p) return;editing=p.id;document.getElementById('p_name').value=p.name;document.getElementById('p_price').value=p.price;document.getElementById('p_brand').value=p.brand;document.getElementById('p_stock').value=p.stock;document.getElementById('p_cat').value=p.cat;document.getElementById('p_img').value=p.img;document.getElementById('p_desc').value=p.desc;document.getElementById('adminModal').classList.add('open')}

    function clearPartForm(){['p_name','p_price','p_brand','p_stock','p_img','p_desc'].forEach(id=>document.getElementById(id).value='');document.getElementById('p_cat').value='motor'}

    document.getElementById('savePart').addEventListener('click',()=>{const name=document.getElementById('p_name').value.trim();const price=Number(document.getElementById('p_price').value);const brand=document.getElementById('p_brand').value.trim();const stock=Number(document.getElementById('p_stock').value);const cat=document.getElementById('p_cat').value;const img=document.getElementById('p_img').value.trim();const desc=document.getElementById('p_desc').value.trim();if(!name||!brand||!price) return alert('Complete nombre, marca y precio');if(editing){const parts=getParts();const idx=parts.findIndex(x=>x.id===editing);if(idx===-1) return alert('Error');parts[idx]={...parts[idx],name,brand,price,stock,cat,img,desc};saveParts(parts);alert('Repuesto actualizado')}else{const parts=getParts();parts.unshift({id:uid(),name,brand,model:'',year:'',price,stock,cat,img,desc});saveParts(parts);alert('Repuesto agregado')}clearPartForm();document.getElementById('adminModal').classList.remove('open');renderCatalog();editing=null})

    document.getElementById('deletePart').addEventListener('click',()=>{if(!editing) return alert('Seleccione un repuesto para eliminar');if(!confirm('Eliminar repuesto?')) return;const parts=getParts().filter(p=>p.id!==editing);saveParts(parts);editing=null;clearPartForm();document.getElementById('adminModal').classList.remove('open');renderCatalog()})

    function deleteEditing(){document.getElementById('deletePart').click()}
    function cancelEdit(){clearPartForm();editing=null;document.getElementById('adminModal').classList.remove('open')}

    function fillAdminAppts(){const list=getAppts().sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));document.getElementById('adminAppts').innerHTML=list.map(a=>`<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px"><div style="font-weight:700">${escapeHtml(a.name)}</div><div style="color:var(--muted)">${escapeHtml(a.brand)} ${escapeHtml(a.model)} ‚Ä¢ ${a.year||''}</div><div style="color:var(--muted);font-size:13px">${new Date(a.datetime).toLocaleString()}</div><div style="margin-top:6px"><button class='nav-btn' onclick="deleteAppt('${a.id}')">Eliminar</button></div></div>`).join('')||'<div style="color:var(--muted)">Sin turnos</div>'}
    function deleteAppt(id){if(!confirm('Eliminar turno?')) return;const updated=getAppts().filter(a=>a.id!==id);saveAppts(updated);fillAdminAppts();renderAppts()}

    // Appointments
    document.getElementById('submitAppt').addEventListener('click',()=>{const name=document.getElementById('apptName').value.trim();const phone=document.getElementById('apptPhone').value.trim();const brand=document.getElementById('apptBrand').value.trim();const year=document.getElementById('apptYear').value.trim();const datetime=document.getElementById('apptDatetime').value;const problemShort=document.getElementById('apptProblemShort').value.trim();if(!name||!phone||!brand||!datetime) return alert('Complete nombre, tel√©fono, marca y fecha/hora');const appt={id:uid(),name,phone,brand,model:'',year,datetime,problemShort,created:new Date().toISOString()};const arr=getAppts();arr.push(appt);saveAppts(arr);renderAppts();const modal=document.getElementById('confirmModal');document.getElementById('confirmContent').innerHTML=`<div style="font-weight:800;color:#fff;font-size:18px">Turno agendado</div><div style="margin-top:10px;color:var(--muted)">Muchas gracias por elegirnos ‚Äî su turno fue registrado para <strong>${new Date(datetime).toLocaleString()}</strong></div>`;modal.classList.add('open');['apptName','apptPhone','apptBrand','apptYear','apptDatetime','apptProblemShort'].forEach(id=>document.getElementById(id).value='');fillAdminAppts()})

    function renderAppts(){const list=getAppts().sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));const el=document.getElementById('apptList');el.innerHTML=list.map(a=>`<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px"><div style="font-weight:700">${escapeHtml(a.name)}</div><div style="color:var(--muted)">${escapeHtml(a.brand)} ‚Ä¢ ${a.year||''}</div><div style="color:var(--muted);font-size:13px">${new Date(a.datetime).toLocaleString()}</div><div style="color:var(--muted);margin-top:6px">${escapeHtml(a.problemShort||'')}</div></div>`).join('')||'<div style="color:var(--muted)">Sin turnos</div>'}

    // small confirmation for add-to-cart
    function showTempConfirm(title,msg){const modal=document.getElementById('confirmModal');document.getElementById('confirmContent').innerHTML=`<div style="font-weight:800;color:#fff">${title}</div><div style="margin-top:8px;color:var(--muted)">${escapeHtml(msg)}</div>`;modal.classList.add('open');setTimeout(()=>{modal.classList.remove('open')},1200)}

    // utility: render initial
    function renderInitial(){renderCatalog();renderAppts();renderCart();updateCartCount()}

    // events: search & filters
    document.getElementById('search').addEventListener('input',()=>renderCatalog());
    document.getElementById('filterCategory').addEventListener('change',()=>renderCatalog());
    document.getElementById('sortPrice').addEventListener('change',()=>renderCatalog());

    // expose for inline
    window.openEdit=openEdit;window.addToCart=addToCart;window.openCart=openCart;window.openCheckout=openCheckout;window.closeConfirm=closeConfirm;window.closeCart=closeCart;window.closeCheckout=closeCheckout;window.deleteAppt=deleteAppt;window.showDetails=showDetails;

    // start
    renderInitial();
  </script>
</body>
</html>
